<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Records – Jyotiba Finance Group</title>

<style>
body{
  margin:0;
  font-family: system-ui, Arial, sans-serif;
  background:#f4f6f8;
}
header{
  background:#1565c0;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:700;
}
.container{
  padding:14px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}
input, select{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-bottom:8px;
}
.btn{
  display:inline-block;
  padding:8px 12px;
  border-radius:10px;
  background:#1565c0;
  color:#fff;
  text-decoration:none;
  font-weight:600;
  margin-right:6px;
}
.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.list-item{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px solid #eee;
}
.small{
  color:#666;
  font-size:14px;
}
.total{
  font-size:22px;
  font-weight:700;
  color:#1565c0;
}
</style>
</head>

<body>

<header>Jyotiba Finance Group</header>

<div class="container">

  <div class="card">
    <div class="small">Filters</div>

    <input type="date" id="fromDate" placeholder="From date">
    <input type="date" id="toDate" placeholder="To date">
    <input type="text" id="borrower" placeholder="Borrower name">

    <div class="row">
      <button class="btn" onclick="applyFilters()">Apply</button>
      <button class="btn" onclick="resetFilters()">Reset</button>
      <button class="btn" onclick="exportCSV()">Export CSV</button>
      <a class="btn" href="index.html">⬅ Dashboard</a>
    </div>
  </div>

  <div class="card">
    <div class="small">Total (Filtered)</div>
    <div id="totalAmount" class="total">₹0</div>
  </div>

  <div class="card">
    <div class="small">All Records</div>
    <div id="recordsList"></div>
  </div>

</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHMVetLYoyRzDg57nOm2drb4pSyw33hqNsOTI9F92rD7bnk2p7sUypioSdhSNH_zcGO75kmsBKM5VI/pub?gid=1158021320&single=true&output=csv";
let allData = [];

function parseCSV(text){
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  return lines.slice(1).map(row=>{
    const values = row.split(",");
    let obj = {};
    headers.forEach((h,i)=> obj[h.trim()] = values[i]?.trim());
    return obj;
  });
}

function render(data){
  const list = document.getElementById("recordsList");
  list.innerHTML = "";
  let total = 0;

  if(data.length === 0){
    list.innerHTML = "<div class='small'>No records found</div>";
    document.getElementById("totalAmount").textContent = "₹0";
    return;
  }

  data.forEach(row=>{
    const amt = Number(row["Collected Amount"] || 0);
    total += amt;

    const div = document.createElement("div");
    div.className = "list-item";
    div.innerHTML = `
      <span>
        <strong>${row["Borrower Name"]}</strong><br>
        <span class="small">${row["Date"]} • ${row["Payment Method"] || ""}</span>
      </span>
      <strong>₹${amt.toFixed(2)}</strong>
    `;
    list.appendChild(div);
  });

  document.getElementById("totalAmount").textContent = "₹" + total.toFixed(2);
}

function applyFilters(){
  const from = document.getElementById("fromDate").value;
  const to = document.getElementById("toDate").value;
  const borrower = document.getElementById("borrower").value.toLowerCase();

  const filtered = allData.filter(row=>{
    if(from && row["Date"] < from) return false;
    if(to && row["Date"] > to) return false;
    if(borrower && !row["Borrower Name"].toLowerCase().includes(borrower)) return false;
    return true;
  });

  render(filtered);
}

function resetFilters(){
  document.getElementById("fromDate").value = "";
  document.getElementById("toDate").value = "";
  document.getElementById("borrower").value = "";
  render(allData);
}

function exportCSV(){
  let csv = "Date,Borrower,Collected,Remaining,Method,Notes\n";
  allData.forEach(r=>{
    csv += `${r["Date"]},${r["Borrower Name"]},${r["Collected Amount"]},${r["Remaining Amount"] || ""},${r["Payment Method"] || ""},${r["Notes"] || ""}\n`;
  });
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "jyotiba_finance_records.csv";
  a.click();
}

fetch(SHEET_URL)
  .then(res => res.text())
  .then(csv => {
    allData = parseCSV(csv);
    render(allData);
  });
</script>

</body>
</html>
